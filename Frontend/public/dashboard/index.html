<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background-color: #FFCCDC;
    }

    body>* {
      opacity: .3;
    }
  </style>
  <title>Adoro Embalar</title>
</head>

<body>


  <input type="text" >
  <button onclick="createOrder()">Criar pedido</button>


  <script>
    fetch('http://localhost:3000/orders', {
       method: 'GET',
       headers: {
         'Accept': 'application/json',
         'Content-Type': 'application/json'
        }
      })
      .then((resp) => resp.json())
      .then((data) => {
          document.querySelector('.orders .loading').remove();
          data.forEach(order => {
            document.querySelector('.orders').innerHTML += `<div class="order"><div>${order.code}</div><div>${order.date}</div></div>`;
          });
      })
      .catch(function (error) {
          console.log(error);
      });

function simulateTab() {
    var TAB_KEY = 9;    
    var keyboardEvent = document.createEvent("KeyboardEvent");
    var initMethod = typeof keyboardEvent.initKeyboardEvent !== 'undefined' ? "initKeyboardEvent" : "initKeyEvent";
    keyboardEvent[initMethod]("keydown", true, true, window, 0, 0, 0, 0, 0, TAB_KEY);
    document.dispatchEvent(keyboardEvent);
  }
  
    function createOrder() {
      fetch('http://localhost:3000/create-order', {
          method: 'POST',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            code: document.querySelector("input").value
          })
        })
        .then((resp) => resp.json())
        .then((data) => {
          if (data.error) {
            alert(data.error)
          } else {
            alert('Pedido criado')
          }
          document.querySelector('input').focus();
          document.querySelector('input').value = '';
        })
        .catch(function (error) {
          console.log(error);
        });

    }

    document.addEventListener("DOMContentLoaded", function(event) {
      simulateTab();
    });
    
    document.querySelector('body').addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        document.querySelector('input').click();
        createOrder()
      }
    });


  </script>
</body>

</html>